<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚·ãƒ£ã‚«ã‚·ãƒ£ã‚«ãƒ»ã‚ªãƒ¼ãƒ«ã‚¹ã‚¿ãƒ¼ã‚º</title>
    <style>
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; position: fixed; background: #f0f0f0;
        }
        /* ç”»åƒã‚’åŒ…ã‚€ç®±ã®è¨­å®š */
        .box {
            width: 80px; height: 80px; /* å°‘ã—å°ã•ã‚ã«ã—ã¦ãŸãã•ã‚“å…¥ã‚‹ã‚ˆã†ã« */
            position: absolute;
            display: flex; justify-content: center; align-items: center;
            touch-action: none; /* ãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨™æº–å‹•ä½œã‚’ç„¡åŠ¹åŒ– */
        }
        .box img { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        
        button {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; font-size: 20px; z-index: 1000;
            border-radius: 50px; border: none; background: #333; color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

    <button id="startBtn">å…¨å“¡é›†åˆï¼ã‚·ãƒ£ã‚«ã‚·ãƒ£ã‚«é–‹å§‹ ğŸš€</button>

    <script>
        const boxes = [];
        const btn = document.getElementById('startBtn');
        const numImages = 9; // 1.png ã€œ 9.png

        // 1. ç”»åƒãŸã¡ã®æº–å‚™
        for (let i = 1; i <= numImages; i++) {
            const div = document.createElement('div');
            div.className = 'box';
            div.innerHTML = `<img src="${i}.png">`;
            document.body.appendChild(div);

            // å„ç”»åƒã®åˆæœŸçŠ¶æ…‹
            boxes.push({
                el: div,
                px: Math.random() * (window.innerWidth - 80),
                py: Math.random() * (window.innerHeight - 80),
                vx: 0, vy: 0,
                angle: Math.random() * 360,
                va: 0,
                isDragging: false
            });
        }

        btn.addEventListener('click', () => {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(state => { if (state === 'granted') run(); });
            } else { run(); }
            btn.style.display = 'none';
        });

        function run() {
            // ã‚»ãƒ³ã‚µãƒ¼ã®åŠ›ã‚’å…¨å“¡ã«ä¼ãˆã‚‹
            window.addEventListener("devicemotion", (e) => {
                let ag = e.accelerationIncludingGravity;
                if (!ag.x) return;
                boxes.forEach(b => {
                    if (!b.isDragging) {
                        b.vx -= ag.x * 0.6; // å°‘ã—é‡ã‚ã«èª¿æ•´
                        b.vy += ag.y * 0.6;
                        b.va += ag.x * 0.4;
                    }
                });
            });

            // ã‚¿ãƒƒãƒæ“ä½œï¼ˆè§¦ã£ãŸç”»åƒã ã‘æ´ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
            boxes.forEach(b => {
                b.el.addEventListener('touchstart', (e) => {
                    b.isDragging = true;
                    b.vx = 0; b.vy = 0; b.va = 0;
                });
                window.addEventListener('touchmove', (e) => {
                    if (!b.isDragging) return;
                    let touch = Array.from(e.touches).find(t => t.target === b.el || b.el.contains(t.target));
                    if (touch) {
                        b.px = touch.clientX - 40;
                        b.py = touch.clientY - 40;
                    }
                }, {passive: false});
                window.addEventListener('touchend', () => { b.isDragging = false; });
            });

            function update() {
                boxes.forEach(b => {
                    if (!b.isDragging) {
                        b.vx *= 0.95; b.vy *= 0.95; b.va *= 0.92;
                        b.px += b.vx; b.py += b.vy; b.angle += b.va;

                        const size = 80;
                        // å£ã¨ã®è¡çªåˆ¤å®š
                        if (b.px < 0) { b.px = 0; b.vx *= -0.7; b.va += b.vy * 0.1; }
                        if (b.px > window.innerWidth - size) { b.px = window.innerWidth - size; b.vx *= -0.7; b.va -= b.vy * 0.1; }
                        if (b.py < 0) { b.py = 0; b.vy *= -0.7; b.va -= b.vx * 0.1; }
                        if (b.py > window.innerHeight - size) { b.py = window.innerHeight - size; b.vy *= -0.7; b.va += b.vx * 0.1; }
                    }
                    b.el.style.transform = `translate(${b.px}px, ${py = b.py}px) rotate(${b.angle}deg)`;
                });
                requestAnimationFrame(update);
            }
            update();
        }
    </script>
</body>
</html>
